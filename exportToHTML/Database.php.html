<html>
<head>
<title>Database.php</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.ln { color: #81969a; font-weight: normal; font-style: normal; }
.s0 { color: rgb(190,80,70); font-weight: bold; }
.s1 { color: rgb(129,194,121); }
.s2 { color: rgb(102,116,123); }
.s3 { color: rgb(197,120,220); font-weight: bold; }
.s4 { color: rgb(245,249,247); }
.s5 { color: rgb(213,222,221); }
.s6 { color: rgb(189,125,210); font-weight: bold; }
.s7 { color: rgb(241,115,128); }
.s8 { color: rgb(225,232,227); }
.s9 { color: rgb(222,220,220); }
.s10 { color: rgb(208,154,102); }
.s11 { color: rgb(238,245,245); }
.s12 { color: rgb(4,163,202); }
.s13 { color: rgb(86,182,193); }
.s14 { color: rgb(71,123,116); }
.ls0 { height: 1px; border-width: 0; color: rgb(70,79,83); background-color:rgb(70,79,83)}
</style>
</head>
<BODY BGCOLOR="#292d35">
<TABLE CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<TR><TD><CENTER>
<FONT FACE="Arial, Helvetica" COLOR="#000000">
Database.php</FONT>
</center></TD></TR></TABLE>
<pre>
<span class="s0">&lt;?php</span><span class="s1"> <hr class="ls0"></span><span class="s2">/** 
 * Created by PhpStorm. 
 * User: Vasq 
 * Date: 6/03/2017 
 * Time: 19:13 
 */</span><span class="s1"> 
 
</span><span class="s3">namespace </span><span class="s1">System</span><span class="s4">;</span><span class="s1"> 
 
</span><span class="s3">use </span><span class="s1">PDO</span><span class="s4">;</span><span class="s1"> 
</span><span class="s3">USE </span><span class="s1">PDOException</span><span class="s4">;</span><span class="s1"> 
 <hr class="ls0"></span><span class="s3">class </span><span class="s1">Database 
</span><span class="s5">{</span><span class="s1"> 
    </span><span class="s2">/** 
     * Application Object 
     * </span><span class="s6">@var </span><span class="s2">\System\Application 
     */</span><span class="s1"> 
 
    </span><span class="s3">private </span><span class="s7">$app</span><span class="s4">;</span><span class="s1"> 
    </span><span class="s2">/** 
     * PDO Connection 
     * </span><span class="s6">@var </span><span class="s2">\Pdo 
     */</span><span class="s1"> 
    </span><span class="s3">private static </span><span class="s7">$connection</span><span class="s4">;</span><span class="s1"> 
 
    </span><span class="s2">/** 
     * Table Name 
     * </span><span class="s6">@var </span><span class="s2">string 
     */</span><span class="s1"> 
    </span><span class="s3">private </span><span class="s7">$table</span><span class="s4">;</span><span class="s1"> 
 
    </span><span class="s2">/** 
     * Bindings Container 
     * </span><span class="s6">@var </span><span class="s2">array 
     */</span><span class="s1"> 
    </span><span class="s3">private </span><span class="s7">$bindings </span><span class="s8">= </span><span class="s9">[]</span><span class="s4">;</span><span class="s1"> 
 
    </span><span class="s2">/** 
     * Last Insert Id 
     * </span><span class="s6">@var </span><span class="s2">int 
     */</span><span class="s1"> 
    </span><span class="s3">private </span><span class="s7">$lastId</span><span class="s4">;</span><span class="s1"> 
 
    </span><span class="s2">/** 
     * Data Container 
     * </span><span class="s6">@var </span><span class="s2">array 
     */</span><span class="s1"> 
    </span><span class="s3">private </span><span class="s7">$data </span><span class="s8">= </span><span class="s9">[]</span><span class="s4">;</span><span class="s1"> 
 
 
    </span><span class="s2">/** 
     * Wheres 
     * </span><span class="s6">@var </span><span class="s2">array 
     */</span><span class="s1"> 
    </span><span class="s3">private </span><span class="s7">$wheres </span><span class="s8">= </span><span class="s9">[]</span><span class="s4">;</span><span class="s1"> 
 
 
    </span><span class="s2">/** 
     * Selects 
     * </span><span class="s6">@var </span><span class="s2">array 
     */</span><span class="s1"> 
    </span><span class="s3">private </span><span class="s7">$selects </span><span class="s8">= </span><span class="s9">[]</span><span class="s4">;</span><span class="s1"> 
 
    </span><span class="s2">/** 
     * Limit 
     * </span><span class="s6">@var </span><span class="s2">int 
     */</span><span class="s1"> 
    </span><span class="s3">private </span><span class="s7">$limit</span><span class="s4">;</span><span class="s1"> 
 
    </span><span class="s2">/** 
     * Offset 
     * </span><span class="s6">@var </span><span class="s2">int 
     */</span><span class="s1"> 
    </span><span class="s3">private </span><span class="s7">$offset</span><span class="s4">;</span><span class="s1"> 
 
    </span><span class="s2">/** 
     * Total Rows 
     * </span><span class="s6">@var </span><span class="s2">int 
     */</span><span class="s1"> 
    </span><span class="s3">private </span><span class="s7">$rows </span><span class="s8">= </span><span class="s10">0</span><span class="s4">;</span><span class="s1"> 
 
    </span><span class="s2">/** 
     * Joins 
     * </span><span class="s6">@var </span><span class="s2">array 
     */</span><span class="s1"> 
    </span><span class="s3">private </span><span class="s7">$joins </span><span class="s8">= </span><span class="s9">[]</span><span class="s4">;</span><span class="s1"> 
 
    </span><span class="s2">/** 
     * Order By 
     * </span><span class="s6">@var </span><span class="s2">array 
     */</span><span class="s1"> 
    </span><span class="s3">private </span><span class="s7">$orderBy </span><span class="s8">= </span><span class="s9">[]</span><span class="s4">;</span><span class="s1"> 
 
    </span><span class="s2">/** 
     * Database constructor. 
     * </span><span class="s6">@param </span><span class="s2">Application $app 
     */</span><span class="s1"> 
 
    </span><span class="s3">public function </span><span class="s1">__construct</span><span class="s11">(</span><span class="s1">Application </span><span class="s7">$app</span><span class="s11">)</span><span class="s1"> 
    </span><span class="s5">{</span><span class="s1"> 
        </span><span class="s7">$this</span><span class="s8">-&gt;</span><span class="s1">app </span><span class="s8">= </span><span class="s7">$app</span><span class="s4">;</span><span class="s1"> 
 
        </span><span class="s3">if </span><span class="s11">(</span><span class="s8">!</span><span class="s7">$this</span><span class="s8">-&gt;</span><span class="s1">isConnected</span><span class="s11">()) </span><span class="s5">{</span><span class="s1"> 
            </span><span class="s7">$this</span><span class="s8">-&gt;</span><span class="s1">connect</span><span class="s11">()</span><span class="s4">;</span><span class="s1"> 
        </span><span class="s5">}</span><span class="s1"> 
    </span><span class="s5">}</span><span class="s1"> 
 
    </span><span class="s2">/** 
     *  Determine if there is any connecion to database 
     * </span><span class="s6">@return </span><span class="s2">bool 
     */</span><span class="s1"> 
    </span><span class="s3">private function </span><span class="s1">isConnected</span><span class="s11">()</span><span class="s1"> 
    </span><span class="s5">{</span><span class="s1"> 
        </span><span class="s3">return static</span><span class="s8">::</span><span class="s7">$connection </span><span class="s3">instanceof </span><span class="s1">PDO</span><span class="s4">;</span><span class="s1"> 
    </span><span class="s5">}</span><span class="s1"> 
 
    </span><span class="s2">/** 
     *  Connect To Database 
     * </span><span class="s6">@return </span><span class="s2">void 
     */</span><span class="s1"> 
    </span><span class="s3">private function </span><span class="s1">connect</span><span class="s11">()</span><span class="s1"> 
    </span><span class="s5">{</span><span class="s1"> 
        </span><span class="s7">$connectionData </span><span class="s8">= </span><span class="s7">$this</span><span class="s8">-&gt;</span><span class="s1">app</span><span class="s8">-&gt;</span><span class="s1">file</span><span class="s8">-&gt;</span><span class="s1">call</span><span class="s11">(</span><span class="s12">&quot;Config.php&quot;</span><span class="s11">)</span><span class="s4">;</span><span class="s1"> 
        </span><span class="s13">extract</span><span class="s11">(</span><span class="s7">$connectionData</span><span class="s11">)</span><span class="s4">;</span><span class="s1"> 
        </span><span class="s3">try </span><span class="s5">{</span><span class="s1"> 
            </span><span class="s3">static</span><span class="s8">::</span><span class="s7">$connection </span><span class="s8">= </span><span class="s3">new </span><span class="s1">PDO</span><span class="s11">(</span><span class="s12">'mysql:host=' </span><span class="s8">. </span><span class="s7">$server </span><span class="s8">. </span><span class="s12">';dbname=' </span><span class="s8">. </span><span class="s7">$dbname</span><span class="s1">, </span><span class="s7">$dbuser</span><span class="s1">, </span><span class="s7">$dbpass</span><span class="s11">)</span><span class="s4">;</span><span class="s1"> 
            </span><span class="s3">static</span><span class="s8">::</span><span class="s7">$connection</span><span class="s8">-&gt;</span><span class="s1">setAttribute</span><span class="s11">(</span><span class="s1">PDO</span><span class="s8">::</span><span class="s1">ATTR_DEFAULT_FETCH_MODE, PDO</span><span class="s8">::</span><span class="s1">FETCH_OBJ</span><span class="s11">)</span><span class="s4">;</span><span class="s1"> 
            </span><span class="s3">static</span><span class="s8">::</span><span class="s7">$connection</span><span class="s8">-&gt;</span><span class="s1">setAttribute</span><span class="s11">(</span><span class="s1">PDO</span><span class="s8">::</span><span class="s1">ATTR_ERRMODE, PDO</span><span class="s8">::</span><span class="s1">ERRMODE_EXCEPTION</span><span class="s11">)</span><span class="s4">;</span><span class="s1"> 
            </span><span class="s3">static</span><span class="s8">::</span><span class="s7">$connection</span><span class="s8">-&gt;</span><span class="s1">exec</span><span class="s11">(</span><span class="s12">'SET NAMES utf8'</span><span class="s11">)</span><span class="s4">;</span><span class="s1"> 
        </span><span class="s5">} </span><span class="s3">catch </span><span class="s11">(</span><span class="s1">PDOException </span><span class="s7">$e</span><span class="s11">) </span><span class="s5">{</span><span class="s1"> 
            </span><span class="s3">die</span><span class="s11">(</span><span class="s7">$e</span><span class="s8">-&gt;</span><span class="s1">getMessage</span><span class="s11">())</span><span class="s4">;</span><span class="s1"> 
        </span><span class="s5">}</span><span class="s1"> 
 
    </span><span class="s5">}</span><span class="s1"> 
 
    </span><span class="s2">/** 
     * Get Database Connection Obkect PDO Object 
     * </span><span class="s6">@return </span><span class="s2">\PDO 
     */</span><span class="s1"> 
 
    </span><span class="s3">public function </span><span class="s1">connection</span><span class="s11">()</span><span class="s1"> 
    </span><span class="s5">{</span><span class="s1"> 
        </span><span class="s3">return static</span><span class="s8">::</span><span class="s7">$connection</span><span class="s4">;</span><span class="s1"> 
    </span><span class="s5">}</span><span class="s1"> 
 
    </span><span class="s2">/** 
     * Set select clause 
     * 
     * </span><span class="s6">@param </span><span class="s2">string $select 
     * </span><span class="s6">@return </span><span class="s2">$this 
     */</span><span class="s1"> 
 
    </span><span class="s3">public function </span><span class="s1">select</span><span class="s11">(</span><span class="s7">$select</span><span class="s11">)</span><span class="s1"> 
    </span><span class="s5">{</span><span class="s1"> 
        </span><span class="s7">$this</span><span class="s8">-&gt;</span><span class="s1">selects</span><span class="s9">[] </span><span class="s8">= </span><span class="s7">$select</span><span class="s4">;</span><span class="s1"> 
        </span><span class="s3">return </span><span class="s7">$this</span><span class="s4">;</span><span class="s1"> 
    </span><span class="s5">}</span><span class="s1"> 
 
 
    </span><span class="s2">/** 
     * Set Join clause 
     * 
     * </span><span class="s6">@param </span><span class="s2">string $join 
     * </span><span class="s6">@return </span><span class="s2">$this 
     */</span><span class="s1"> 
 
    </span><span class="s3">public function </span><span class="s13">join</span><span class="s11">(</span><span class="s7">$join</span><span class="s11">)</span><span class="s1"> 
    </span><span class="s5">{</span><span class="s1"> 
        </span><span class="s7">$this</span><span class="s8">-&gt;</span><span class="s1">joins</span><span class="s9">[] </span><span class="s8">= </span><span class="s7">$join</span><span class="s4">;</span><span class="s1"> 
        </span><span class="s3">return </span><span class="s7">$this</span><span class="s4">;</span><span class="s1"> 
    </span><span class="s5">}</span><span class="s1"> 
 
 
    </span><span class="s2">/** 
     *  Set the table name 
     * 
     * </span><span class="s6">@param </span><span class="s2">string $table 
     * </span><span class="s6">@return </span><span class="s2">$this 
     */</span><span class="s1"> 
    </span><span class="s3">public function </span><span class="s1">table</span><span class="s11">(</span><span class="s7">$table</span><span class="s11">)</span><span class="s1"> 
    </span><span class="s5">{</span><span class="s1"> 
        </span><span class="s7">$this</span><span class="s8">-&gt;</span><span class="s1">table </span><span class="s8">= </span><span class="s7">$table</span><span class="s4">;</span><span class="s1"> 
        </span><span class="s3">return </span><span class="s7">$this</span><span class="s4">;</span><span class="s1"> 
    </span><span class="s5">}</span><span class="s1"> 
 
 
 
 
    </span><span class="s2">/** 
     * Set Limit and offset 
     * 
     * </span><span class="s6">@param </span><span class="s2">int $limit 
     * </span><span class="s6">@param </span><span class="s2">int $offset 
     * </span><span class="s6">@return </span><span class="s2">$this 
     */</span><span class="s1"> 
 
    </span><span class="s3">public function </span><span class="s1">limit</span><span class="s11">(</span><span class="s7">$limit</span><span class="s1">, </span><span class="s7">$offset </span><span class="s8">= </span><span class="s10">0</span><span class="s11">)</span><span class="s1"> 
    </span><span class="s5">{</span><span class="s1"> 
        </span><span class="s7">$this</span><span class="s8">-&gt;</span><span class="s1">limit </span><span class="s8">= </span><span class="s7">$limit</span><span class="s4">;</span><span class="s1"> 
        </span><span class="s7">$this</span><span class="s8">-&gt;</span><span class="s1">offset </span><span class="s8">= </span><span class="s7">$offset</span><span class="s4">;</span><span class="s1"> 
        </span><span class="s3">return </span><span class="s7">$this</span><span class="s4">;</span><span class="s1"> 
    </span><span class="s5">}</span><span class="s1"> 
 
 
    </span><span class="s2">/** 
     * Ftech Table 
     * This will return only one record 
     * 
     * </span><span class="s6">@param </span><span class="s2">string $table 
     * </span><span class="s6">@return </span><span class="s2">\stdClass / null 
     */</span><span class="s1"> 
 
    </span><span class="s3">public function </span><span class="s1">fetch</span><span class="s11">(</span><span class="s7">$table </span><span class="s8">= </span><span class="s1">null</span><span class="s11">)</span><span class="s1"> 
    </span><span class="s5">{</span><span class="s1"> 
        </span><span class="s3">if</span><span class="s11">(</span><span class="s7">$table</span><span class="s11">)</span><span class="s5">{</span><span class="s1"> 
            </span><span class="s7">$this</span><span class="s8">-&gt;</span><span class="s1">table</span><span class="s11">(</span><span class="s7">$table</span><span class="s11">)</span><span class="s4">;</span><span class="s1"> 
        </span><span class="s5">}</span><span class="s1"> 
 
        </span><span class="s7">$sql </span><span class="s8">= </span><span class="s7">$this</span><span class="s8">-&gt;</span><span class="s1">fetchStatement</span><span class="s11">()</span><span class="s4">;</span><span class="s1"> 
        </span><span class="s7">$result </span><span class="s8">= </span><span class="s7">$this</span><span class="s8">-&gt;</span><span class="s1">query</span><span class="s11">(</span><span class="s7">$sql</span><span class="s1">,</span><span class="s7">$this</span><span class="s8">-&gt;</span><span class="s1">bindings</span><span class="s11">)</span><span class="s8">-&gt;</span><span class="s1">fetch</span><span class="s11">()</span><span class="s4">;</span><span class="s1"> 
        </span><span class="s3">return </span><span class="s7">$result</span><span class="s4">;</span><span class="s1"> 
    </span><span class="s5">}</span><span class="s1"> 
 
    </span><span class="s2">/** 
     * Fetch ALL Records from TABLE 
     * This will return only one record 
     * 
     * </span><span class="s6">@param </span><span class="s2">string $table 
     * </span><span class="s6">@return </span><span class="s2">array 
     */</span><span class="s1"> 
 
    </span><span class="s3">public function </span><span class="s1">fetchAll</span><span class="s11">(</span><span class="s7">$table </span><span class="s8">= </span><span class="s1">null</span><span class="s11">)</span><span class="s1"> 
    </span><span class="s5">{</span><span class="s1"> 
        </span><span class="s3">if</span><span class="s11">(</span><span class="s7">$table</span><span class="s11">)</span><span class="s5">{</span><span class="s1"> 
            </span><span class="s7">$this</span><span class="s8">-&gt;</span><span class="s1">table</span><span class="s11">(</span><span class="s7">$table</span><span class="s11">)</span><span class="s4">;</span><span class="s1"> 
        </span><span class="s5">}</span><span class="s1"> 
 
        </span><span class="s7">$sql </span><span class="s8">= </span><span class="s7">$this</span><span class="s8">-&gt;</span><span class="s1">fetchStatement</span><span class="s11">()</span><span class="s4">;</span><span class="s1"> 
        </span><span class="s7">$query </span><span class="s8">= </span><span class="s7">$this</span><span class="s8">-&gt;</span><span class="s1">query</span><span class="s11">(</span><span class="s7">$sql</span><span class="s1">,</span><span class="s7">$this</span><span class="s8">-&gt;</span><span class="s1">bindings</span><span class="s11">)</span><span class="s4">;</span><span class="s1"> 
        </span><span class="s7">$results </span><span class="s8">= </span><span class="s7">$query</span><span class="s8">-&gt;</span><span class="s1">fetchAll</span><span class="s11">()</span><span class="s4">;</span><span class="s1"> 
        </span><span class="s7">$this</span><span class="s8">-&gt;</span><span class="s1">rows </span><span class="s8">= </span><span class="s7">$query</span><span class="s8">-&gt;</span><span class="s1">rowCount</span><span class="s11">()</span><span class="s4">;</span><span class="s1"> 
        </span><span class="s3">return </span><span class="s7">$results</span><span class="s4">;</span><span class="s1"> 
    </span><span class="s5">}</span><span class="s1"> 
 
    </span><span class="s2">/** 
     * Get total rows from Last fetch all statement 
     * </span><span class="s6">@return </span><span class="s2">int 
     */</span><span class="s1"> 
    </span><span class="s3">public function </span><span class="s1">rows</span><span class="s11">()</span><span class="s1"> 
    </span><span class="s5">{</span><span class="s1"> 
        </span><span class="s3">return </span><span class="s7">$this</span><span class="s8">-&gt;</span><span class="s1">rows</span><span class="s4">;</span><span class="s1"> 
    </span><span class="s5">}</span><span class="s1"> 
 
    </span><span class="s2">/** 
     * Prepare Select statement 
     * </span><span class="s6">@return </span><span class="s2">string 
     */</span><span class="s1"> 
 
    </span><span class="s3">private function </span><span class="s1">fetchStatement</span><span class="s11">()</span><span class="s1"> 
    </span><span class="s5">{</span><span class="s1"> 
        </span><span class="s7">$sql </span><span class="s8">= </span><span class="s12">'SELECT'</span><span class="s4">;</span><span class="s1"> 
        </span><span class="s3">if</span><span class="s11">(</span><span class="s7">$this</span><span class="s8">-&gt;</span><span class="s1">selects</span><span class="s11">)</span><span class="s5">{</span><span class="s1"> 
            </span><span class="s7">$sql </span><span class="s8">.= </span><span class="s13">implode</span><span class="s11">(</span><span class="s12">','</span><span class="s1">, </span><span class="s7">$this</span><span class="s8">-&gt;</span><span class="s1">selects</span><span class="s11">)</span><span class="s4">;</span><span class="s1"> 
        </span><span class="s5">}</span><span class="s3">else</span><span class="s5">{</span><span class="s1"> 
            </span><span class="s7">$sql </span><span class="s8">.= </span><span class="s12">'*'</span><span class="s4">;</span><span class="s1"> 
        </span><span class="s5">}</span><span class="s1"> 
 
        </span><span class="s7">$sql </span><span class="s8">.= </span><span class="s12">' FROM ' </span><span class="s8">. </span><span class="s7">$this</span><span class="s8">-&gt;</span><span class="s1">table</span><span class="s8">. </span><span class="s12">' '</span><span class="s4">;</span><span class="s1"> 
 
        </span><span class="s3">if</span><span class="s11">(</span><span class="s7">$this</span><span class="s8">-&gt;</span><span class="s1">joins</span><span class="s11">)</span><span class="s5">{</span><span class="s1"> 
            </span><span class="s7">$sql </span><span class="s8">.= </span><span class="s13">implode</span><span class="s11">(</span><span class="s12">' ' </span><span class="s1">, </span><span class="s7">$this</span><span class="s8">-&gt;</span><span class="s1">joins</span><span class="s11">)</span><span class="s4">;</span><span class="s1"> 
        </span><span class="s5">}</span><span class="s1"> 
 
        </span><span class="s3">if</span><span class="s11">(</span><span class="s7">$this</span><span class="s8">-&gt;</span><span class="s1">wheres</span><span class="s11">)</span><span class="s5">{</span><span class="s1"> 
            </span><span class="s7">$sql </span><span class="s8">.= </span><span class="s12">' WHERE '</span><span class="s8">. </span><span class="s13">implode</span><span class="s11">(</span><span class="s12">' '</span><span class="s1">, </span><span class="s7">$this</span><span class="s8">-&gt;</span><span class="s1">wheres</span><span class="s11">)</span><span class="s8">. </span><span class="s12">' '</span><span class="s4">;</span><span class="s1"> 
        </span><span class="s5">}</span><span class="s1"> 
 
        </span><span class="s3">if</span><span class="s11">(</span><span class="s7">$this</span><span class="s8">-&gt;</span><span class="s1">limit</span><span class="s11">)</span><span class="s5">{</span><span class="s1"> 
            </span><span class="s7">$sql </span><span class="s8">.= </span><span class="s12">' LIMIT '</span><span class="s8">. </span><span class="s7">$this</span><span class="s8">-&gt;</span><span class="s1">limit</span><span class="s4">;</span><span class="s1"> 
        </span><span class="s5">}</span><span class="s1"> 
 
        </span><span class="s3">if</span><span class="s11">(</span><span class="s7">$this</span><span class="s8">-&gt;</span><span class="s1">offset</span><span class="s11">)</span><span class="s5">{</span><span class="s1"> 
            </span><span class="s7">$sql </span><span class="s8">.= </span><span class="s12">' OFFSET'</span><span class="s8">. </span><span class="s7">$this</span><span class="s8">-&gt;</span><span class="s1">offset</span><span class="s4">;</span><span class="s1"> 
        </span><span class="s5">}</span><span class="s1"> 
 
        </span><span class="s3">if</span><span class="s11">(</span><span class="s7">$this</span><span class="s8">-&gt;</span><span class="s1">orderBy</span><span class="s11">)</span><span class="s5">{</span><span class="s1"> 
            </span><span class="s7">$sql </span><span class="s8">.= </span><span class="s12">' ORDER BY '</span><span class="s8">. </span><span class="s13">implode</span><span class="s11">(</span><span class="s12">' '</span><span class="s1">,</span><span class="s7">$this</span><span class="s8">-&gt;</span><span class="s1">orderBy</span><span class="s11">)</span><span class="s4">;</span><span class="s1"> 
        </span><span class="s5">}</span><span class="s1"> 
 
        </span><span class="s3">return </span><span class="s7">$sql</span><span class="s4">;</span><span class="s1"> 
    </span><span class="s5">}</span><span class="s1"> 
 
 
    </span><span class="s2">/** 
     * Set Order By clause 
     * 
     * </span><span class="s6">@param </span><span class="s2">string $column 
     * </span><span class="s6">@param </span><span class="s2">string $sort 
     * </span><span class="s6">@return </span><span class="s2">$this 
     */</span><span class="s1"> 
 
    </span><span class="s3">public function </span><span class="s1">orderBy</span><span class="s11">(</span><span class="s7">$orderBy</span><span class="s1">, </span><span class="s7">$sort </span><span class="s8">= </span><span class="s12">'ASC'</span><span class="s11">)</span><span class="s1"> 
    </span><span class="s5">{</span><span class="s1"> 
        </span><span class="s7">$this</span><span class="s8">-&gt;</span><span class="s1">orderBy </span><span class="s8">= </span><span class="s9">[</span><span class="s7">$orderBy</span><span class="s1">, </span><span class="s7">$sort</span><span class="s9">]</span><span class="s4">;</span><span class="s1"> 
        </span><span class="s3">return </span><span class="s7">$this</span><span class="s4">;</span><span class="s1"> 
    </span><span class="s5">}</span><span class="s1"> 
 
 
 
 
 
    </span><span class="s2">/** 
     *  Set the table name 
     * 
     * </span><span class="s6">@param </span><span class="s2">string $table 
     * </span><span class="s6">@return </span><span class="s2">$this 
     */</span><span class="s1"> 
    </span><span class="s3">public function </span><span class="s1">from</span><span class="s11">(</span><span class="s7">$table</span><span class="s11">)</span><span class="s1"> 
    </span><span class="s5">{</span><span class="s1"> 
        </span><span class="s3">return </span><span class="s7">$this</span><span class="s8">-&gt;</span><span class="s1">table</span><span class="s11">(</span><span class="s7">$table</span><span class="s11">)</span><span class="s4">;</span><span class="s1"> 
    </span><span class="s5">}</span><span class="s1"> 
 
    </span><span class="s2">/** 
     *  Set the Data that will be stored in database table 
     * </span><span class="s6">@param </span><span class="s2">mixed $key 
     * </span><span class="s6">@param </span><span class="s2">mixed $value 
     * </span><span class="s6">@return </span><span class="s2">$this 
     */</span><span class="s1"> 
 
    </span><span class="s14">/* 
     $this-&gt;db-&gt;data([ 
        'name' =&gt; 'Ricardo', 
        'apellido' =&gt; 'vasquez' 
     ]); 
        or 
      $this-&gt;db-&gt;data('name','Ricardo')-&gt;data('apellido','vasquez'); 
     */</span><span class="s1"> 
 
    </span><span class="s3">public function </span><span class="s1">data</span><span class="s11">(</span><span class="s7">$key</span><span class="s1">, </span><span class="s7">$value </span><span class="s8">= </span><span class="s1">null</span><span class="s11">)</span><span class="s1"> 
    </span><span class="s5">{</span><span class="s1"> 
        </span><span class="s3">if </span><span class="s11">(</span><span class="s13">is_array</span><span class="s11">(</span><span class="s7">$key</span><span class="s11">)) </span><span class="s5">{</span><span class="s1"> 
            </span><span class="s7">$this</span><span class="s8">-&gt;</span><span class="s1">data </span><span class="s8">= </span><span class="s13">array_merge</span><span class="s11">(</span><span class="s7">$this</span><span class="s8">-&gt;</span><span class="s1">data, </span><span class="s7">$key</span><span class="s11">)</span><span class="s4">; </span><span class="s14">//si es array agrega todos los valores a data</span><span class="s1"> 
            </span><span class="s7">$this</span><span class="s8">-&gt;</span><span class="s1">addToBindings</span><span class="s11">(</span><span class="s7">$key</span><span class="s11">)</span><span class="s4">;</span><span class="s1"> 
 
        </span><span class="s5">} </span><span class="s3">else </span><span class="s5">{</span><span class="s1"> 
            </span><span class="s7">$this</span><span class="s8">-&gt;</span><span class="s1">data</span><span class="s9">[</span><span class="s7">$key</span><span class="s9">] </span><span class="s8">= </span><span class="s7">$value</span><span class="s4">;</span><span class="s1"> 
            </span><span class="s7">$this</span><span class="s8">-&gt;</span><span class="s1">addToBindings</span><span class="s11">(</span><span class="s7">$value</span><span class="s11">)</span><span class="s4">;</span><span class="s1"> 
        </span><span class="s5">}</span><span class="s1"> 
        </span><span class="s3">return </span><span class="s7">$this</span><span class="s4">;</span><span class="s1"> 
    </span><span class="s5">}</span><span class="s1"> 
 
    </span><span class="s2">/** 
     * Insert Data to database 
     * 
     * </span><span class="s6">@param </span><span class="s2">string $table 
     * </span><span class="s6">@return </span><span class="s2">$this 
     * 
     */</span><span class="s1"> 
    </span><span class="s3">public function </span><span class="s1">insert</span><span class="s11">(</span><span class="s7">$table </span><span class="s8">= </span><span class="s1">null</span><span class="s11">)</span><span class="s1"> 
    </span><span class="s5">{</span><span class="s1"> 
        </span><span class="s3">if </span><span class="s11">(</span><span class="s7">$table</span><span class="s11">) </span><span class="s5">{</span><span class="s1"> 
            </span><span class="s7">$this</span><span class="s8">-&gt;</span><span class="s1">table</span><span class="s11">(</span><span class="s7">$table</span><span class="s11">)</span><span class="s4">;</span><span class="s1"> 
        </span><span class="s5">}</span><span class="s1"> 
        </span><span class="s7">$sql </span><span class="s8">= </span><span class="s12">'INSERT INTO ' </span><span class="s8">. </span><span class="s7">$this</span><span class="s8">-&gt;</span><span class="s1">table </span><span class="s8">. </span><span class="s12">' SET '</span><span class="s4">;</span><span class="s1"> 
        </span><span class="s7">$sql </span><span class="s8">.= </span><span class="s7">$this</span><span class="s8">-&gt;</span><span class="s1">setFields</span><span class="s11">()</span><span class="s4">;</span><span class="s1"> 
        </span><span class="s7">$this</span><span class="s8">-&gt;</span><span class="s1">query</span><span class="s11">(</span><span class="s7">$sql</span><span class="s1">, </span><span class="s7">$this</span><span class="s8">-&gt;</span><span class="s1">bindings</span><span class="s11">)</span><span class="s4">;</span><span class="s1"> 
        </span><span class="s7">$this</span><span class="s8">-&gt;</span><span class="s1">lastId </span><span class="s8">= </span><span class="s7">$this</span><span class="s8">-&gt;</span><span class="s1">connection</span><span class="s11">()</span><span class="s8">-&gt;</span><span class="s1">lastInsertId</span><span class="s11">()</span><span class="s4">;</span><span class="s1"> 
        </span><span class="s3">return </span><span class="s7">$this</span><span class="s4">;</span><span class="s1"> 
    </span><span class="s5">}</span><span class="s1"> 
 
    </span><span class="s2">/** 
     * Update Data in database 
     * 
     * </span><span class="s6">@param </span><span class="s2">string $table 
     * </span><span class="s6">@return </span><span class="s2">$this 
     * 
     */</span><span class="s1"> 
    </span><span class="s3">public function </span><span class="s1">update</span><span class="s11">(</span><span class="s7">$table </span><span class="s8">= </span><span class="s1">null</span><span class="s11">)</span><span class="s1"> 
    </span><span class="s5">{</span><span class="s1"> 
        </span><span class="s3">if </span><span class="s11">(</span><span class="s7">$table</span><span class="s11">) </span><span class="s5">{</span><span class="s1"> 
            </span><span class="s7">$this</span><span class="s8">-&gt;</span><span class="s1">table</span><span class="s11">(</span><span class="s7">$table</span><span class="s11">)</span><span class="s4">;</span><span class="s1"> 
        </span><span class="s5">}</span><span class="s1"> 
        </span><span class="s7">$sql </span><span class="s8">= </span><span class="s12">'UPDATE ' </span><span class="s8">. </span><span class="s7">$this</span><span class="s8">-&gt;</span><span class="s1">table </span><span class="s8">. </span><span class="s12">' SET '</span><span class="s4">;</span><span class="s1"> 
 
        </span><span class="s7">$sql </span><span class="s8">.= </span><span class="s7">$this</span><span class="s8">-&gt;</span><span class="s1">setFields</span><span class="s11">()</span><span class="s4">;</span><span class="s1"> 
        </span><span class="s3">if</span><span class="s11">(</span><span class="s7">$this</span><span class="s8">-&gt;</span><span class="s1">wheres</span><span class="s11">)</span><span class="s5">{</span><span class="s1"> 
            </span><span class="s7">$sql </span><span class="s8">.= </span><span class="s12">' WHERE ' </span><span class="s8">. </span><span class="s13">implode</span><span class="s11">(</span><span class="s12">'' </span><span class="s1">, </span><span class="s7">$this</span><span class="s8">-&gt;</span><span class="s1">wheres</span><span class="s11">)</span><span class="s4">;</span><span class="s1"> 
        </span><span class="s5">}</span><span class="s1"> 
        </span><span class="s7">$this</span><span class="s8">-&gt;</span><span class="s1">query</span><span class="s11">(</span><span class="s7">$sql</span><span class="s1">, </span><span class="s7">$this</span><span class="s8">-&gt;</span><span class="s1">bindings</span><span class="s11">)</span><span class="s4">;</span><span class="s1"> 
        </span><span class="s3">return </span><span class="s7">$this</span><span class="s4">;</span><span class="s1"> 
    </span><span class="s5">}</span><span class="s1"> 
 
    </span><span class="s2">/** 
     * Delete Clause 
     * 
     * </span><span class="s6">@param </span><span class="s2">string $table 
     * </span><span class="s6">@return </span><span class="s2">$this 
     * 
     */</span><span class="s1"> 
    </span><span class="s3">public function </span><span class="s13">delete</span><span class="s11">(</span><span class="s7">$table </span><span class="s8">= </span><span class="s1">null</span><span class="s11">)</span><span class="s1"> 
    </span><span class="s5">{</span><span class="s1"> 
        </span><span class="s3">if </span><span class="s11">(</span><span class="s7">$table</span><span class="s11">) </span><span class="s5">{</span><span class="s1"> 
            </span><span class="s7">$this</span><span class="s8">-&gt;</span><span class="s1">table</span><span class="s11">(</span><span class="s7">$table</span><span class="s11">)</span><span class="s4">;</span><span class="s1"> 
        </span><span class="s5">}</span><span class="s1"> 
        </span><span class="s7">$sql </span><span class="s8">= </span><span class="s12">'DELETE FROM ' </span><span class="s8">. </span><span class="s7">$this</span><span class="s8">-&gt;</span><span class="s1">table </span><span class="s8">. </span><span class="s12">' '</span><span class="s4">;</span><span class="s1"> 
 
        </span><span class="s3">if</span><span class="s11">(</span><span class="s7">$this</span><span class="s8">-&gt;</span><span class="s1">wheres</span><span class="s11">)</span><span class="s5">{</span><span class="s1"> 
            </span><span class="s7">$sql </span><span class="s8">.= </span><span class="s12">' WHERE ' </span><span class="s8">. </span><span class="s13">implode</span><span class="s11">(</span><span class="s12">'' </span><span class="s1">, </span><span class="s7">$this</span><span class="s8">-&gt;</span><span class="s1">wheres</span><span class="s11">)</span><span class="s4">;</span><span class="s1"> 
        </span><span class="s5">}</span><span class="s1"> 
        </span><span class="s7">$this</span><span class="s8">-&gt;</span><span class="s1">query</span><span class="s11">(</span><span class="s7">$sql</span><span class="s1">, </span><span class="s7">$this</span><span class="s8">-&gt;</span><span class="s1">bindings</span><span class="s11">)</span><span class="s4">;</span><span class="s1"> 
        </span><span class="s3">return </span><span class="s7">$this</span><span class="s4">;</span><span class="s1"> 
    </span><span class="s5">}</span><span class="s1"> 
 
    </span><span class="s2">/** 
     * Set the fields for insert and update 
     * </span><span class="s6">@return </span><span class="s2">string 
     */</span><span class="s1"> 
    </span><span class="s3">private function </span><span class="s1">setFields</span><span class="s11">()</span><span class="s1"> 
    </span><span class="s5">{</span><span class="s1"> 
        </span><span class="s7">$sql </span><span class="s8">= </span><span class="s12">''</span><span class="s4">;</span><span class="s1"> 
        </span><span class="s3">foreach </span><span class="s11">(</span><span class="s13">array_keys</span><span class="s11">(</span><span class="s7">$this</span><span class="s8">-&gt;</span><span class="s1">data</span><span class="s11">) </span><span class="s3">as </span><span class="s7">$key</span><span class="s11">) </span><span class="s5">{</span><span class="s1"> 
            </span><span class="s7">$sql </span><span class="s8">.= </span><span class="s12">'`' </span><span class="s8">. </span><span class="s7">$key </span><span class="s8">. </span><span class="s12">'` = ? , '</span><span class="s4">;</span><span class="s1"> 
        </span><span class="s5">}</span><span class="s1"> 
 
        </span><span class="s7">$sql </span><span class="s8">= </span><span class="s13">rtrim</span><span class="s11">(</span><span class="s7">$sql</span><span class="s1">, </span><span class="s12">', '</span><span class="s11">)</span><span class="s4">;</span><span class="s1"> 
        </span><span class="s3">return </span><span class="s7">$sql</span><span class="s4">;</span><span class="s1"> 
 
    </span><span class="s5">}</span><span class="s1"> 
 
    </span><span class="s2">/** 
     * Add New Where clause 
     * </span><span class="s6">@return </span><span class="s2">$this 
     */</span><span class="s1"> 
 
    </span><span class="s3">public function </span><span class="s1">where</span><span class="s11">()</span><span class="s1"> 
    </span><span class="s5">{</span><span class="s1"> 
        </span><span class="s7">$bindings </span><span class="s8">= </span><span class="s13">func_get_args</span><span class="s11">()</span><span class="s4">;</span><span class="s1"> 
        </span><span class="s7">$sql </span><span class="s8">= </span><span class="s13">array_shift</span><span class="s11">(</span><span class="s7">$bindings</span><span class="s11">)</span><span class="s4">;</span><span class="s1"> 
        </span><span class="s7">$this</span><span class="s8">-&gt;</span><span class="s1">addToBindings</span><span class="s11">(</span><span class="s7">$bindings</span><span class="s11">)</span><span class="s4">;</span><span class="s1"> 
        </span><span class="s7">$this</span><span class="s8">-&gt;</span><span class="s1">wheres</span><span class="s9">[] </span><span class="s8">= </span><span class="s7">$sql</span><span class="s4">;</span><span class="s1"> 
        </span><span class="s3">return </span><span class="s7">$this</span><span class="s4">;</span><span class="s1"> 
    </span><span class="s5">}</span><span class="s1"> 
 
 
    </span><span class="s2">/** 
     * Execute the given sql statement 
     * </span><span class="s6">@return </span><span class="s2">\PDOStatement 
     */</span><span class="s1"> 
    </span><span class="s3">public function </span><span class="s1">query</span><span class="s11">()</span><span class="s1"> 
    </span><span class="s5">{</span><span class="s1"> 
        </span><span class="s7">$bindings </span><span class="s8">= </span><span class="s13">func_get_args</span><span class="s11">()</span><span class="s4">;</span><span class="s1"> 
        </span><span class="s7">$sql </span><span class="s8">= </span><span class="s13">array_shift</span><span class="s11">(</span><span class="s7">$bindings</span><span class="s11">)</span><span class="s4">;</span><span class="s1"> 
 
        </span><span class="s3">if </span><span class="s11">(</span><span class="s13">count</span><span class="s11">(</span><span class="s7">$bindings</span><span class="s11">) </span><span class="s8">== </span><span class="s10">1 </span><span class="s3">AND </span><span class="s13">is_array</span><span class="s11">(</span><span class="s7">$bindings</span><span class="s9">[</span><span class="s10">0</span><span class="s9">]</span><span class="s11">)) </span><span class="s5">{</span><span class="s1"> 
            </span><span class="s7">$bindings </span><span class="s8">= </span><span class="s7">$bindings</span><span class="s9">[</span><span class="s10">0</span><span class="s9">]</span><span class="s4">;</span><span class="s1"> 
        </span><span class="s5">}</span><span class="s1"> 
 
        </span><span class="s3">try </span><span class="s5">{</span><span class="s1"> 
            </span><span class="s7">$query </span><span class="s8">= </span><span class="s7">$this</span><span class="s8">-&gt;</span><span class="s1">connection</span><span class="s11">()</span><span class="s8">-&gt;</span><span class="s1">prepare</span><span class="s11">(</span><span class="s7">$sql</span><span class="s11">)</span><span class="s4">;</span><span class="s1"> 
 
            </span><span class="s3">foreach </span><span class="s11">(</span><span class="s7">$bindings </span><span class="s3">as </span><span class="s7">$key </span><span class="s8">=&gt; </span><span class="s7">$value</span><span class="s11">) </span><span class="s5">{</span><span class="s1"> 
                </span><span class="s7">$query</span><span class="s8">-&gt;</span><span class="s1">bindValue</span><span class="s11">(</span><span class="s7">$key </span><span class="s8">+ </span><span class="s10">1</span><span class="s1">, _e</span><span class="s11">(</span><span class="s7">$value</span><span class="s11">))</span><span class="s4">;</span><span class="s1"> 
            </span><span class="s5">}</span><span class="s1"> 
            </span><span class="s7">$query</span><span class="s8">-&gt;</span><span class="s1">execute</span><span class="s11">()</span><span class="s4">;</span><span class="s1"> 
            </span><span class="s7">$this</span><span class="s8">-&gt;</span><span class="s1">reset</span><span class="s11">()</span><span class="s4">;</span><span class="s1"> 
 
            </span><span class="s3">return </span><span class="s7">$query</span><span class="s4">;</span><span class="s1"> 
        </span><span class="s5">} </span><span class="s3">catch </span><span class="s11">(</span><span class="s1">PDOException </span><span class="s7">$e</span><span class="s11">) </span><span class="s5">{</span><span class="s1"> 
 
            </span><span class="s3">echo </span><span class="s7">$e</span><span class="s8">-&gt;</span><span class="s1">getMessage</span><span class="s11">()</span><span class="s4">;</span><span class="s1"> 
        </span><span class="s5">}</span><span class="s1"> 
    </span><span class="s5">}</span><span class="s1"> 
 
    </span><span class="s3">private function </span><span class="s13">reset</span><span class="s11">()</span><span class="s5">{</span><span class="s1"> 
 
        </span><span class="s14">//$this-&gt;rows = 0;</span><span class="s1"> 
        </span><span class="s7">$this</span><span class="s8">-&gt;</span><span class="s1">limit </span><span class="s8">= </span><span class="s1">null</span><span class="s4">;</span><span class="s1"> 
        </span><span class="s7">$this</span><span class="s8">-&gt;</span><span class="s1">offset </span><span class="s8">= </span><span class="s1">null</span><span class="s4">;</span><span class="s1"> 
        </span><span class="s7">$this</span><span class="s8">-&gt;</span><span class="s1">table </span><span class="s8">= </span><span class="s1">null</span><span class="s4">;</span><span class="s1"> 
        </span><span class="s7">$this</span><span class="s8">-&gt;</span><span class="s1">bindings </span><span class="s8">= </span><span class="s9">[]</span><span class="s4">;</span><span class="s1"> 
        </span><span class="s7">$this</span><span class="s8">-&gt;</span><span class="s1">data </span><span class="s8">= </span><span class="s9">[]</span><span class="s4">;</span><span class="s1"> 
        </span><span class="s7">$this</span><span class="s8">-&gt;</span><span class="s1">selects </span><span class="s8">= </span><span class="s9">[]</span><span class="s4">;</span><span class="s1"> 
        </span><span class="s7">$this</span><span class="s8">-&gt;</span><span class="s1">joins </span><span class="s8">= </span><span class="s9">[]</span><span class="s4">;</span><span class="s1"> 
        </span><span class="s7">$this</span><span class="s8">-&gt;</span><span class="s1">wheres </span><span class="s8">= </span><span class="s9">[]</span><span class="s4">;</span><span class="s1"> 
        </span><span class="s7">$this</span><span class="s8">-&gt;</span><span class="s1">orderBy </span><span class="s8">= </span><span class="s9">[]</span><span class="s4">;</span><span class="s1"> 
    </span><span class="s5">}</span><span class="s1"> 
 
    </span><span class="s2">/** 
     * Get the las insert id 
     * </span><span class="s6">@return </span><span class="s2">int 
     */</span><span class="s1"> 
    </span><span class="s3">public function </span><span class="s1">lastId</span><span class="s11">()</span><span class="s1"> 
    </span><span class="s5">{</span><span class="s1"> 
        </span><span class="s3">return </span><span class="s7">$this</span><span class="s8">-&gt;</span><span class="s1">lastId</span><span class="s4">;</span><span class="s1"> 
    </span><span class="s5">}</span><span class="s1"> 
 
 
    </span><span class="s2">/** 
     * Add the given value to bindings 
     * </span><span class="s6">@param </span><span class="s2">midex $value 
     * </span><span class="s6">@return  </span><span class="s2">void 
     * 
     */</span><span class="s1"> 
    </span><span class="s3">private function </span><span class="s1">addToBindings</span><span class="s11">(</span><span class="s7">$value</span><span class="s11">)</span><span class="s1"> 
    </span><span class="s5">{</span><span class="s1"> 
        </span><span class="s3">if</span><span class="s11">(</span><span class="s13">is_array</span><span class="s11">(</span><span class="s7">$value</span><span class="s11">))</span><span class="s5">{</span><span class="s1"> 
            </span><span class="s7">$this</span><span class="s8">-&gt;</span><span class="s1">bindings </span><span class="s8">= </span><span class="s13">array_merge</span><span class="s11">(</span><span class="s7">$this</span><span class="s8">-&gt;</span><span class="s1">bindings,</span><span class="s13">array_values</span><span class="s11">(</span><span class="s7">$value</span><span class="s11">))</span><span class="s4">;</span><span class="s1"> 
        </span><span class="s5">}</span><span class="s3">else</span><span class="s5">{</span><span class="s1"> 
              </span><span class="s7">$this</span><span class="s8">-&gt;</span><span class="s1">bindings</span><span class="s9">[] </span><span class="s8">= </span><span class="s7">$value</span><span class="s4">;</span><span class="s1"> 
        </span><span class="s5">}</span><span class="s1"> 
 
 
    </span><span class="s5">}</span><span class="s1"> 
 
</span><span class="s5">}</span></pre>
</body>
</html>